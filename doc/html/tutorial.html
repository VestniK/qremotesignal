<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>QRemoteSignal: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="tutorial">Tutorial </a></h1><p>This article provides step by step tutorial of creation client-server applications with the QRemoteSignal library. You can find compleate source code of the example application described here in the <em>examples/hello</em> directory of the libbrary source package.</p>
<h2><a class="anchor" id="hello_service">
Application remote interface</a></h2>
<p>Lets create simple client-server application. The client can connect to the server and send a name. The server will send the string "Hello "+name in response on the message from client.</p>
<p>First of all we need to create some services describing server remote interface. For our small server it will be enough to have only one service. Lets create XML file with the name <b>hello.xml</b> with the following content:  <div class="fragment"><pre class="fragment">&lt;service name=<span class="stringliteral">&quot;Hello&quot;</span>&gt;
   &lt;slot name=<span class="stringliteral">&quot;setName&quot;</span>&gt;
      &lt;param name=<span class="stringliteral">&quot;name&quot;</span> type=<span class="stringliteral">&quot;QString&quot;</span>/&gt;
   &lt;/slot&gt;
   &lt;signal name=<span class="stringliteral">&quot;hello&quot;</span>&gt;
      &lt;param name=<span class="stringliteral">&quot;greetings&quot;</span> type=<span class="stringliteral">&quot;QString&quot;</span>/&gt;
   &lt;/signal&gt;
&lt;/service&gt;
</pre></div> It contains one slot <b>setName</b> which allows our client to send a name to the server and one signal <b>hello</b> which allows our server to send greetings string to our client.</p>
<p>Now we can generate C++ classes which we can use in our application (see <a class="el" href="qrsc.html#code_generation">C++ code generation with qrsc utility</a> for details). We can do it with the following commands: </p>
<div class="fragment"><pre class="fragment"> qrsc --service --header helloservice.h --source helloservice.cpp hello.xml
 qrsc --client --header helloclient.h --source helloclient.cpp hello.xml
</pre></div><p> Or we can write some build script which will invoke this commands from build system (some help on this topic you can find in <a class="el" href="qrsc.html#build_systems">How to invoke qrsc from different build systems</a> document).</p>
<p>We will get 4 files: </p>
<ul>
<li><b>helloservice.h</b> and <b>helloservice.cpp</b> which we will use in the server application. </li>
<li><b>helloclient.h</b> and <b>helloclient.cpp</b> which we will use in the client application.</li>
</ul>
<h2><a class="anchor" id="hello_server">
Server application</a></h2>
<p>Our server application will contain Server class which creates QTcpServer listening some port and processing new incomming connections. After new connection established it creates Connection class instance which will work with the socket. This instance will be deleted if socket is disconnected.</p>
<p>Main function and Server class contain no QRemoteSignal specific code it's just usual QtNetwork library ussage. Here is the code: </p>
<ul>
<li><a class="el" href="hello_2server_2main_8cpp-example.html">server/main.cpp </a> </li>
<li><a class="el" href="hello_2server_2server_8h-example.html">server/server.h </a> </li>
<li><a class="el" href="hello_2server_2server_8cpp-example.html">server/server.cpp </a></li>
</ul>
<p>All magick is done in the <b>Connection</b> class. First of all in its constructor we should create <a class="el" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> class instance. Then we can create <b>HelloService</b> class instance and register it in our services manager:  <div class="fragment"><pre class="fragment">   <a class="code" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> *manager = <span class="keyword">new</span> <a class="code" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a>(<span class="keyword">this</span>);
   mService = <span class="keyword">new</span> qrs::HelloService(manager);
</pre></div> Now <b>mService</b> instance also become a child of <b>manager</b> instance and will be deleted if <b>manager</b> is deleted. QRemoteSignal library actively uses Qt4 memory management features to simplify memory management in you application. Constructor generated for the <b>HelloService</b> class which takes pointer to a <a class="el" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> class instance automatically registers newly created <b>HelloService</b> instace in the <a class="el" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> instance passed to it and set this manager instance to be its parent.</p>
<p>Now we need to connect <b>HelloService</b> signals and slots to some signal and slots in our application to provide meaningfull reaction on incomming requests. For our small server it's enough to provide one slot which will be connected to <b>HelloService::setName</b> signal. This slot will call <b>HelloService::hello</b> slot with greetings string:  <div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> Connection::onSetName(<span class="keyword">const</span> QString &amp;name) {
   mService-&gt;hello( QString(<span class="stringliteral">&quot;Hello %1&quot;</span>).arg(name) );
}
</pre></div></p>
<p>And in the <b>Connection</b> class constructor we need to connect <b>setName</b> signal to this slot right after <b>HelloService</b> instance creation:  <div class="fragment"><pre class="fragment">   connect(mService,SIGNAL(setName(QString)),
           <span class="keyword">this</span>,SLOT(onSetName(<span class="keyword">const</span> QString&amp;)));
</pre></div></p>
<p>After that we need add socket to the list of devices used by <b>manager</b> for sending/receiving raw messages:  <div class="fragment"><pre class="fragment">   manager-&gt;<a class="code" href="classqrs_1_1ServicesManager.html#a505f7466de581e1e6e34503dd50802e8" title="Add IO device to send receive data.">addDevice</a>(socket);
</pre></div></p>
<p>Lets take a look on compleate <b>Connection</b> class code: </p>
<ul>
<li>connection.h <div class="fragment"><pre class="fragment">
<span class="preprocessor">#ifndef Connection_H</span>
<span class="preprocessor"></span><span class="preprocessor">#define Connection_H</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;QtCore/QObject&gt;</span>
<span class="preprocessor">#include &lt;QtNetwork/QTcpSocket&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="QRemoteSignal.html" title="Public library header file containing all necessary classes.">QRemoteSignal</a>&gt;</span>

<span class="preprocessor">#include &quot;helloservice.h&quot;</span>

<span class="keyword">class </span>Connection : <span class="keyword">public</span> QObject {
   Q_OBJECT
   <span class="keyword">public</span>:
      Connection(QTcpSocket *socket, QObject *parent = 0);
      <span class="keyword">virtual</span> ~Connection() {};
   <span class="keyword">private</span> slots:
      <span class="keywordtype">void</span> onSetName(<span class="keyword">const</span> QString&amp; name);
   <span class="keyword">private</span>:
      qrs::HelloService *mService;
};

<span class="preprocessor">#endif</span>
</pre></div> </li>
<li>connection.cpp  <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;connection.h&quot;</span>

<span class="preprocessor">#include &lt;QtCore/QCoreApplication&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="QRemoteSignal.html" title="Public library header file containing all necessary classes.">QRemoteSignal</a>&gt;</span>

Connection::Connection (QTcpSocket *socket, QObject *parent):QObject(parent) {
   socket-&gt;setParent(<span class="keyword">this</span>);
   connect(socket,SIGNAL(disconnected()),
           <span class="keyword">this</span>,SLOT(deleteLater()));

   <a class="code" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> *manager = <span class="keyword">new</span> <a class="code" href="classqrs_1_1ServicesManager.html#adf485bf50c43da69519091bbcab28d23">qrs::ServicesManager</a>(<span class="keyword">this</span>);
   mService = <span class="keyword">new</span> qrs::HelloService(manager);
   connect(mService,SIGNAL(setName(QString)),
           <span class="keyword">this</span>,SLOT(onSetName(<span class="keyword">const</span> QString&amp;)));
   manager-&gt;<a class="code" href="classqrs_1_1ServicesManager.html#a505f7466de581e1e6e34503dd50802e8" title="Add IO device to send receive data.">addDevice</a>(socket);
}

<span class="keywordtype">void</span> Connection::onSetName(<span class="keyword">const</span> QString &amp;name) {
   mService-&gt;hello( QString(<span class="stringliteral">&quot;Hello %1&quot;</span>).arg(name) );
}
</pre></div></li>
</ul>
<p>Server application is ready!</p>
<h2><a class="anchor" id="hello_client">
Client application</a></h2>
<p>Our client application will be simple console application which takes two command line parameters: host to connect to and your name. It sends your name to the server, and waits for <b>hello</b> signal from the server. Once this signal is received it prints received string and stops.</p>
<p>Lets create <b>Client</b> class which takes connected socket in constructor and creates <a class="el" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> using this socket to send/receive raw messages. Also this class will have <b>onHello</b> slot which will listen for a <b>hello</b> signal from the server. This class is similair to <b>Connection</b> class in the server. Here is its code: </p>
<ul>
<li>client.h <div class="fragment"><pre class="fragment">
<span class="preprocessor">#ifndef Client_H</span>
<span class="preprocessor"></span><span class="preprocessor">#define Client_H</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;QtCore/QObject&gt;</span>
<span class="preprocessor">#include &lt;QtCore/QString&gt;</span>
<span class="preprocessor">#include &lt;QtCore/QtGlobal&gt;</span>

<span class="preprocessor">#include &quot;helloclient.h&quot;</span>

<span class="keyword">class </span>QTcpSocket;

<span class="keyword">class </span>Client: <span class="keyword">public</span> QObject {
   Q_OBJECT
   <span class="keyword">public</span>:
      <span class="keyword">explicit</span> Client(QTcpSocket *socket, QObject *parent = 0);
      <span class="keyword">virtual</span> ~Client() {};
      qrs::HelloClient *hello() {<span class="keywordflow">return</span> mClient;}
   <span class="keyword">private</span> slots:
      <span class="keywordtype">void</span> onHello(<span class="keyword">const</span> QString &amp;greetings);
   <span class="keyword">private</span>:
      qrs::HelloClient *mClient;
      QTcpSocket *mSocket;
};

<span class="preprocessor">#endif</span>
</pre></div> </li>
<li>client.cpp <div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &quot;client.h&quot;</span>

<span class="preprocessor">#include &lt;QtCore/QtDebug&gt;</span>
<span class="preprocessor">#include &lt;QtNetwork/QTcpSocket&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="QRemoteSignal.html" title="Public library header file containing all necessary classes.">QRemoteSignal</a>&gt;</span>

<span class="preprocessor">#include &quot;helloclient.h&quot;</span>

Client::Client(QTcpSocket *socket, QObject *parent ):QObject(parent) {
   socket-&gt;setParent(<span class="keyword">this</span>);
   mSocket = socket;

   <a class="code" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> *manager = <span class="keyword">new</span> <a class="code" href="classqrs_1_1ServicesManager.html#adf485bf50c43da69519091bbcab28d23">qrs::ServicesManager</a>(<span class="keyword">this</span>);
   mClient = <span class="keyword">new</span> qrs::HelloClient(manager);
   connect(mClient,SIGNAL(hello(QString)),
           <span class="keyword">this</span>,SLOT(onHello(<span class="keyword">const</span> QString &amp;)));

   manager-&gt;<a class="code" href="classqrs_1_1ServicesManager.html#a505f7466de581e1e6e34503dd50802e8" title="Add IO device to send receive data.">addDevice</a>(mSocket);
}

<span class="keywordtype">void</span> Client::onHello(<span class="keyword">const</span> QString &amp;greetings) {
   qDebug() &lt;&lt; greetings;
   mSocket-&gt;close();
}
</pre></div></li>
</ul>
<p>We have created <a class="el" href="classqrs_1_1ServicesManager.html" title="Class managing communications between services and clients.">qrs::ServicesManager</a> instance, created <b>HelloClient</b> instance and registered it in manager, connected <b>hello</b> signal to slot providing meaningfull reaction on incoming message everything like in the <b>Connection</b> class of the server application.</p>
<p>In our main function we will check command line arguments, connect to the server, create <b>Client</b> class instance and send the name to the server: </p>
<ul>
<li>main.cpp  <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;QtCore/QCoreApplication&gt;</span>
<span class="preprocessor">#include &lt;QtCore/QStringList&gt;</span>

<span class="preprocessor">#include &lt;QtCore/QtDebug&gt;</span>
<span class="preprocessor">#include &lt;QtNetwork/QTcpSocket&gt;</span>

<span class="preprocessor">#include &quot;client.h&quot;</span>

<span class="keyword">const</span> <span class="keywordtype">int</span> CONNECTION_TIMEOUT = 30000;

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {
   QCoreApplication app(argc,argv);
   QStringList args = app.arguments();
   <span class="keywordflow">if</span> ( args.count() != 3 ) {
      qDebug() &lt;&lt; <span class="stringliteral">&quot;Ussage:&quot;</span>;
      qDebug() &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; args[0] &lt;&lt; <span class="stringliteral">&quot;host your_name&quot;</span>;
      <span class="keywordflow">return</span> 1;
   }
   QTcpSocket *socket = <span class="keyword">new</span> QTcpSocket();
   QObject::connect(socket,SIGNAL(disconnected()),
                    qApp,SLOT(quit()));
   socket-&gt;connectToHost(args[1],8081);
   <span class="keywordflow">if</span> ( ! socket-&gt;waitForConnected(CONNECTION_TIMEOUT) ) {
      qDebug() &lt;&lt; <span class="stringliteral">&quot;Could not connect to host&quot;</span> &lt;&lt; args[1];
      qDebug() &lt;&lt; socket-&gt;errorString();
      <span class="keywordflow">return</span> 1;
   }
   Client client(socket);
      client.hello()-&gt;setName(args[2]);
   <span class="keywordflow">return</span> app.exec();
}
</pre></div></li>
</ul>
<p>Now our client applicaion ready! Lets run the server and and try it: </p>
<div class="fragment"><pre class="fragment"> vestnik@vestnik-laptop:~/Development/QRemoteSignal/examples$ ./hello/client/client localhost VestniK
 <span class="stringliteral">&quot;Hello VestniK&quot;</span>
 vestnik@vestnik-laptop:~/Development/QRemoteSignal/examples$
</pre></div><h2><a class="anchor" id="extending_hello">
Extending example with more slots</a></h2>
<p>The most important thing I'm trying to implement in the QRemoteSignal library is simple extesibility of client server applications with new remote callable slots. Lets extend our application with one new function to see how simple it to do.</p>
<p>It's a bit annoying to search your server in the processes list and kill. Lets add ability to shoutdown server application from the client (sure it's not secure but this is simple "hello world" example).</p>
<p>First of all we need to add one more slot to the <b>hello.xml</b> file:  <div class="fragment"><pre class="fragment">   &lt;slot name=<span class="stringliteral">&quot;quit&quot;</span>/&gt;
</pre></div> It takes no parameters and just shoutdown the server.</p>
<p>Now we need to regenerate <b>HelloService</b> and <b>HelloClient</b> classes and connect <b>HelloService::quit</b> signal to <b>qApp-&gt;quit</b> slot in the <b>Connection</b> class constructor. Lets add the following lines after <b>HelloService</b> instance creation:  <div class="fragment"><pre class="fragment">   connect(mService,SIGNAL(quit()),
           qApp,SLOT(quit()));
</pre></div></p>
<p>Server now provides support of remote shoutdown feature!</p>
<p>Lets modify our client to use this feature. We will just replece this line in the main.cpp file of the client application:  <div class="fragment"><pre class="fragment">      client.hello()-&gt;setName(args[2]);
</pre></div> With this several lines:  <div class="fragment"><pre class="fragment">   <span class="keywordflow">if</span> ( args[2] == <span class="stringliteral">&quot;-q&quot;</span> ) {
      client.hello()-&gt;quit();
   } <span class="keywordflow">else</span> {
      client.hello()-&gt;setName(args[2]);
   }
</pre></div> and that's all we have to do!</p>
<h2><a class="anchor" id="files_list">
Full example sources</a></h2>
<p>Service: </p>
<ul>
<li><a class="el" href="hello_2services_2hello_8xml-example.html">services/hello.xml </a></li>
</ul>
<p>Server: </p>
<ul>
<li><a class="el" href="hello_2server_2main_8cpp-example.html">server/main.cpp </a> </li>
<li><a class="el" href="hello_2server_2server_8h-example.html">server/server.h </a> </li>
<li><a class="el" href="hello_2server_2server_8cpp-example.html">server/server.cpp </a> </li>
<li><a class="el" href="hello_2server_2connection_8h-example.html">server/connection.h </a> </li>
<li><a class="el" href="hello_2server_2connection_8cpp-example.html">server/connection.cpp </a></li>
</ul>
<p>Client: </p>
<ul>
<li><a class="el" href="hello_2client_2main_8cpp-example.html">client/main.cpp </a> </li>
<li><a class="el" href="hello_2client_2client_8h-example.html">client/client.h </a> </li>
<li><a class="el" href="hello_2client_2client_8cpp-example.html">client/client.cpp </a> </li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Mon Feb 15 22:01:28 2010 for QRemoteSignal by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
